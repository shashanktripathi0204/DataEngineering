import os
import requests
from dotenv import load_dotenv
import time
import json  # Import the json module

load_dotenv()
api_key = os.getenv("OPENWEATHER_API_KEY")

city = "Bangalore"

params = {
    "appid": api_key,
    "q": city,
    "units": "metric"
}

url = "https://api.openweathermap.org/data/2.5/weather"
response = requests.get(url, params=params)
print("URL sent:", response.url)
print("Weather data:", response.json())

try:
    # Ensure the ./data directory exists
    os.makedirs("./data", exist_ok=True)
    path = f"./data/raw_{city}_{time.time()}.json"
    with open(path, "w") as file:
        json.dump(response.json(), file, indent=2)  # Serialize as JSON
except FileNotFoundError:
    print(f"Error: The file path:-{path} does not exist")
except PermissionError:
    print("Error: You don't have permission to access this file")
except Exception as e:
    print(f"An unexpected error occurred: {e}")
